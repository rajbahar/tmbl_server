<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title> CliQBoola</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#000">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#000">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-status-bar-style" content="#000">
    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="shortcut icon" href="favicon.ico">
	<link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">
    <meta property="og:type" content="website">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta property="og:url" content="">
</head>
<body>
<!--<div id="pageLoader">
        <div class="loader">
            <div class="lds-heart">
                <div> <img src="images/logo.svg"> </div>
            </div>
        </div>
    </div>-->
	<header>
		<a href="javascript:void(0);" class="logo"> <img src="images/cliq-logo.png"> </a>
		<a href="javascript:void(0);"> <img src="images/logo.png" height="60"> </a>
		<div class="menu">
			<div class="menu-bar"> <span class="line1"></span> <span></span> <span class="line3"></span> </div>
			<nav class="navigation">
			<div class="menu-bar open"> <span class="line1"></span> <span></span> <span class="line3"></span> </div>
				<ul class="clearfix">
					<li><a href="javascript:void(0);"> About CLIQBOLA </a></li>
					<li><a href="javascript:void(0);"> Hot to play <span>(Rules/T&amp;C) </span> </a></li>
					<li id="total_earning"><a href="lucky-draw.html">Total Earnings</a></li>
					<li><a href="javascript:void(0);">Livestream</a></li>
					<li id="login"><a href="login.html">Sign In</a></li>
					<li id="logout" onclick="logout()"><a href="javascript:void(0);">Logout</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<div class="container-fluid"> 
		<div class="row"> 
			<div class="col-sm-12"> 
				<p class="text-lg mt-5">We’ve sent you an OTP <br> to verify your number </p>
					<form class="mt-5" method="post" onsubmit="return enterOtpUser(event)">
						<div class="form-group input-otp" id="enterOtp">
						<label>ENTER OTP </label>
						<input type="tel" name="enterOtp1" id="enterOtp1" maxlength="1" class="form-control" required autofocus autocomplete="off" oninput="changeFocus(1)">
						<input type="tel" name="enterOtp2" id="enterOtp2" maxlength="1" class="form-control" required autocomplete="off" oninput="changeFocus(2)">
						<input type="tel" name="enterOtp3" id="enterOtp3" maxlength="1" class="form-control" required autocomplete="off" oninput="changeFocus(3)">
						<input type="tel" name="enterOtp4" id="enterOtp4" maxlength="1" class="form-control" required autocomplete="off" oninput="changeFocus(4)">
					  </div>
					  
					  <button type="submit" id="verifyBtn" class="btn btn-primary mt-5">Verify</button>
					</form>
					<div class="resend-otp text-center mt-3"> 
					<!--<div class="count"> <img src="images/clock.svg" width="12" class="rotate-animate"> <span id="seconds"> 00 </span>  sec </div>--> 
					<a href="javascript:void(0);" class="btn btn-secondary" id="resend_otp" onclick="resendOtp(event)">Resend OTP </a> </div>
				</div>
		</div>
	</div>
	
<!--Thanks you for registration and otp popup-->
	<div class="modal fade small-popup" id="registerSuccessful" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body">
				<h3> You’re all set <br> and registered</h3>
					<button type="button" class="btn btn-primary mt-1 mb-4 mt-4" onclick="generateTicket()">Generate Ticket</button>
					<div id="error"> </div>
				</div>
			</div>
		</div>
	</div>
<div class="overlay"></div>
<script src="js/jquery-2.2.3.min.js" defer ></script>
<script src="js/popper.min.js" defer ></script>
<script src="js/bootstrap.min.js" defer ></script>
<script src="js/app.js" defer></script>
<script>
let userPhone = localStorage.getItem("Phone");

// Enter User OTP
	function enterOtpUser(e){
	e.preventDefault();
		console.log(document.getElementById("enterOtp1").value + document.getElementById("enterOtp2").value + document.getElementById("enterOtp3").value + document.getElementById("enterOtp4").value);
		var otpValue = document.getElementById("enterOtp1").value + document.getElementById("enterOtp2").value + document.getElementById("enterOtp3").value + document.getElementById("enterOtp4").value;
		var data = {};
		data.Phone = userPhone;		
		data.OTP = otpValue;
		console.log(data);
		$.ajax({
                type: "POST",
                url: "http://13.234.143.20:3005/api/verify/otp",
                data: data,
                cache: false,
                success: function (response) {
					if(response.Success == true){
						console.log(response);
						//console.log(response.Token);
						localStorage.setItem('user_Token', response.Token);
						localStorage.setItem('Phone', response.Profile.Phone);
						
						if(response.Profile.UserDetails == null){
							$('#registerSuccessful').modal('show');
						}else{
							//$('#registerSuccessful').modal('show');							
							localStorage.setItem('UserDetails', JSON.stringify(response.Profile.UserDetails));
							window.location.href = "generated-ticket.html";
						}
					}else{
						$('#error').html('<p>Something went wrong</p>');
					}
                }
            });
                return false;
	};
	
	
//resend OTP
	function resendOtp(e){
	e.preventDefault();
		var data = {};
		data.Phone = userPhone;
		console.log(data);
		$.ajax({
                type: "POST",
				headers: { Authorization: $`Bearer ${localStorage.getItem("token")}` },
                url: "http://13.234.143.20:3005/api/login",
                data: data,
                cache: false,
                success: function (response) {
					if(response.Success == true){
						console.log(response);
					}else{
						$('#error').html('<p>Something went wrong</p>');
					}
                }
            });
                return false;
	};
	
	
	
	// counter for OTP
	//var minutesLabel = document.getElementById("minutes");
	var secondsLabel = document.getElementById("seconds");
	var totalSeconds = 0;
	//setInterval(setTime, 1000);

	/*function setTime() {
	  ++totalSeconds;
	  secondsLabel.innerHTML = pad(totalSeconds % 40);
	  //minutesLabel.innerHTML = pad(parseInt(totalSeconds / 60));
		if( totalSeconds > 39){
			$(".count").hide();
			$("#resend_otp").show();
			clearInterval(setTime);
		}
		
	};

	function pad(val) {
	  var valString = val + "";
	  if (valString.length < 2) {
		return "0" + valString;
	  } else {
		return valString;
	  }
	};*/
	
	

	</script>
	<script>

// Ticket Generating for user
	function generateTicket(){
		var data = {};
		let userPhone = localStorage.getItem('Phone');
		let user_Token = localStorage.getItem('user_Token');
		data.Phone = userPhone;
		console.log(user_Token);
		$.ajax({
                type: "POST",
                url: "http://13.234.143.20:3005/api/tambola/generateticket",
				headers: {"authorization": 'Bearer ' + user_Token},
				//contentType: "application/json",
                data: data,
                cache: false,
                success: function (response) {
					if(response.Success == true){
						window.location.href = "generated-ticket.html";
						console.log(response);
						localStorage.setItem('UserDetails', JSON.stringify(response.Data));
						//console.log(response.Token);
					}else{
						$('#error').html('<p>Something went wrong</p>');
					}
                }
            });
                return false;
	};



let fourcorners = [];
		let crisscross = [];
		let toprow = [];
		let middlerow = [];
		let lastrow = [];
		let fullhouse = [];
		let AnnouncedNumber = [76,65,31,23,45,67,28,5,13,88,62,36,55,78,83,30,43,69];
		let checker = (arr, target) => target.every(v => arr.includes(v));
		if (localStorage.getItem("UserDetails") || localStorage.getItem("UserDetails") === "undefined" || localStorage.getItem("UserDetails") === "") {
			let ticket_Id = document.getElementById("ticket_Id").innerHTML = JSON.parse(localStorage.getItem('UserDetails')).TambolaTicketNumber;

			generate_table(JSON.parse(localStorage.getItem('UserDetails')).TambolaTicket);
			checkLucky();
		}


		function generate_table(e) {
			console.log(e);
			console.log(e.first);
			console.log(e.second);

			console.log(e.third);

			var table = document.getElementById("myTable");
			var row = table.insertRow(0);
			var firstcorner = 0;
			var lastcorner = 0;

			for (let step = 8; step >= 0; step--) {
				var cell1 = row.insertCell(0);
				var currentvalue = e.third[step];
				if (currentvalue > 0) {
					lastrow.push(currentvalue);
					if (lastcorner <= 0)
						lastcorner = currentvalue;
					firstcorner = currentvalue;
					fullhouse.push(currentvalue);
					cell1.innerHTML = "<div id = " + currentvalue + " class='value'> <img src='images/ticket-icons/"+ currentvalue +".svg' /> </div>";
					
				}else{
					cell1.innerHTML = "<div id = " + currentvalue + " class='zero'> " + currentvalue + "</div>";
				}
				
			}
			fourcorners.push(firstcorner);
			fourcorners.push(lastcorner);
			crisscross.push(firstcorner);
			crisscross.push(lastcorner);

			var row = table.insertRow(0);
			var i = 0;
			for (let step = 8; step >= 0; step--) {
				var cell1 = row.insertCell(0);
				var currentvalue = e.second[step];
				if (currentvalue > 0) {
					i++;
					if (i == 3)
						crisscross.push(currentvalue);
					middlerow.push(currentvalue);
					fullhouse.push(currentvalue);
					cell1.innerHTML = "<div id = " + currentvalue + " class='value'>  <img src='images/ticket-icons/"+ currentvalue +".svg' /> </div>";
				}else{
					cell1.innerHTML = "<div id = " + currentvalue + " class='zero'> " + currentvalue + "</div>";
				}
				
			}

			var row = table.insertRow(0);
			firstcorner = 0;
			lastcorner = 0;

			for (let step = 8; step >= 0; step--) {
				var cell1 = row.insertCell(0);
				var currentvalue = e.first[step];
				if (currentvalue > 0) {
					toprow.push(currentvalue);
					if (lastcorner <= 0)
						lastcorner = currentvalue;
					firstcorner = currentvalue;
					fullhouse.push(currentvalue);
					cell1.innerHTML = "<div id = " + currentvalue + " class='value'>  <img src='images/ticket-icons/"+ currentvalue +".svg' /> </div>";
				}else{
					cell1.innerHTML = "<div id = " + currentvalue + " class='zero'> " + currentvalue + "</div>";
				}
			}
			fourcorners.push(firstcorner);
			fourcorners.push(lastcorner);
			crisscross.push(firstcorner);
			crisscross.push(lastcorner);
		};

		function changeFocus(e)
		{
			console.log()
			if(e==1 && document.getElementById("enterOtp1").value.length == 1)
				document.getElementById("enterOtp2").focus();
			else if(e==2 && document.getElementById("enterOtp2").value.length == 1)
				document.getElementById("enterOtp3").focus();
			else if(e==3 && document.getElementById("enterOtp3").value.length == 1)
				document.getElementById("enterOtp4").focus();
			else if(e==4 && document.getElementById("enterOtp4").value.length == 1)
				document.getElementById("verifyBtn").focus();
		}
		
</script>
</body>
</html>
