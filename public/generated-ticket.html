<html class="no-js" lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title> CliQBola</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#000">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#000">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#000">
	<link rel="manifest" href="site.webmanifest">
	<link rel="apple-touch-icon" href="icon.png">
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/app.css">
	<meta property="og:type" content="website">
	<meta property="og:title" content="">
	<meta property="og:description" content="">
	<meta property="og:image" content="">
	<meta property="og:url" content="">
</head>

<body>
	<!--<div id="pageLoader">
         <div class="loader">
            <div class="lds-heart">
               <div> <img src="images/logo.svg"> </div>
            </div>
         </div>
      </div>-->
	<header>
		<a href="javascript:void(0);" class="logo"> <img src="images/cliq-logo.png"> </a>
		<a href="javascript:void(0);"> <img src="images/logo.png" height="60"> </a>
		<div class="menu">
			<div class="menu-bar"> <span class="line1"></span> <span></span> <span class="line3"></span> </div>
			<nav class="navigation">
			<div class="menu-bar open"> <span class="line1"></span> <span></span> <span class="line3"></span> </div>
				<ul class="clearfix">
					<li><a href="javascript:void(0);"> About CLIQBOLA </a></li>
					<li><a href="javascript:void(0);"> Hot to play <span>(Rules/T&amp;C) </span> </a></li>
					<li id="total_earning" onclick="totalEarnings()"><a href="javascript:void(0)">Total Earnings</a></li>
					<li id="liveStreaMenu"><a href="youtube-live.html">Livestream</a></li>
					<li id="login"><a href="login.html">Sign In</a></li>
					<li id="logout" onclick="logout()"><a href="javascript:void(0);">Logout</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-12">
				<p class="text-lg mt-5">HERE'S YOUR LUCKY TICKET</p>
				<div class="fieldset ticket-fieldset">
					<span id="ticket_Id"> <img src="images/logo-dark.svg" width="35"> </span> 
					<div class="ticket">
						<!-- <img src="images/ticket.jpg"> -->
						<table id="myTable" border="1">
						</table>
					</div>
				</div>
				
				<div class="reminder-section text-center mb-5 mt-5"> 
					<p>LOGIN AT 6PM ON MAY 29TH <br> TO PLAY CLIQBOLA.  </p>
					<button class="btn btn-secondary">Set Reminder </button>
				</div>
				<p class="text-lg mt-5">UNLOCK MORE COINS</p>
				<div class="fieldset">
					<div class="play-action">
						<a href="javascript:void(0);" data-toggle="modal" data-target="#riddle"
							onclick="answerRiddle()">
							<img src="images/quiddles.png">
							<span> QUIDDLES </span>
						</a>
						<a href="javascript:void(0);" data-toggle="modal" data-target="#jumble"
							onclick="answerJumble()">
							<img src="images/jumble.png">
							<span> UN-Jumble </span>
						</a>
						<a href="javascript:void(0);" onclick="onreferLinkClick()">
							<img src="images/refer.png">
							<span> Refer a Friend </span>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>




	<!--Answer Riddle Modal Start-->
	<div class="modal fade" id="riddle" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">

					<div class="question-area">
						<p class="win-coin"> Play &amp; win<br> 100coins </p>
						<h3 class="question" id="riddleQuestion"> </h3>
						<form method="post" name="riddleForm" class="answer-options"
							onsubmit="return riddleFormValidate()">
							<div id="riddleAnswerOption">
								<ul id="formGroup">

								</ul>
							</div>
							<div class="form-group">

								<input type="button" value="Submit" class="btn btn-primary" name="riddleAnswer"
									id="riddleAnswer" onclick="submitRiddleAnswer()">
							</div>

						</form>
					</div>
					<div id="error"> </div>
					<div class="error wrongAnswer"> Wrong Answer </div>
				</div>
			</div>
		</div>
	</div>
	<!--Answer Riddle Modal End-->


	<!--Jumble Modal Start-->
	<div class="modal fade" id="jumble" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					
					<div class="question-area">
					<p class="win-coin"> Play &amp; win<br> 100coins </p>
						<h3 class="question"> un-jumble the brand name </h3>
						<div class="jumble-img-area"> <img src="" height="200" id="jumbleImg"> </div>
						<form method="post" name="jumbleForm" class="answer-options" action="youtube-live.html"
							onsubmit="return jumbleFormValidate()">
							<div class="form-group">
								<input type="text" class="form-control" name="jumbleAnswer" id="jumbleAnswer"
									placeholder="Write Answer" disabled="disabled" required>
							</div>
							<div class="form-group jumble-button" id="jumbleButton"> </div>
							<!--<div class="form-group jumble-button">
				<input type="button" class="btn" value="U" onclick="jumbleForm.jumbleAnswer.value += 'U' "> 
				<input type="button" class="btn" value="S" onclick="jumbleForm.jumbleAnswer.value += 'S' "> 	
				<input type="button" class="btn" value="A" onclick="jumbleForm.jumbleAnswer.value += 'A' "> 		
				<input type="button" class="btn" value="S" onclick="jumbleForm.jumbleAnswer.value += 'S' "> 
				<input type="button" class="btn" value="G" onclick="jumbleForm.jumbleAnswer.value += 'G' "> 				
				<input type="button" class="btn" value="N" onclick="jumbleForm.jumbleAnswer.value += 'N' "> 
				<input type="button" class="btn" value="M" onclick="jumbleForm.jumbleAnswer.value += 'M' "> 				
			</div>-->
							<div class="form-group text-center jumbleSubmit">
								<input type="button" class="btn btn-primary" value="Submit"
									onclick="submitJumbleAnswer()">
								<input type="reset" class="btn btn-secondary ml-2" value="Reset">
							</div>
						</form>
					</div>
					<div id="error"> </div>
				</div>
			</div>
		</div>
	</div>
	<!--Jumble Modal End-->
	
	<!--Total Earnings Popup-->
	<div class="modal fade" id="totalEarnings" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
			<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
				<h3 class="mb-4">My Total Earnings</h3>
					<div id="coinBalanceDiv"> 
						<h4> Coin Balance</h4>
						<div class="label"> <span> $ </span> <strong> </strong> </div>
					</div>
					<div id="zoneDiv" class="mt-5"> 
						<h4> Coupon Unlocked</h4>
						<div class="label"> <span> % </span> <strong> </strong> <div class="couponWorth"> Worth INR  <i> </i></div>
					</div>
					<div id="earnedCoinList" class="mt-4"> 
						<h4>Coin Earnings</h4>
						<ul>
							
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>

	<div class="overlay"></div>
	<script src="js/jquery-2.2.3.min.js" defer></script>
	<script src="js/popper.min.js" defer></script>
	<script src="js/bootstrap.min.js" defer></script>
	<script src="js/app.js" defer></script>

	<script>
		//Jumble form validation
		function jumbleFormValidate() {
			let x = document.forms["jumbleForm"]["jumbleAnswer"].value;
			if (x == "") {
				alert("Please solve the Jumble and then submit");
				return false;
			}
		};


		//Riddle form validation		
		/*function riddleFormValidate() {
			
		  let x = document.forms["riddleForm"]["riddleAnswer"].value;
		  if (x == "") {
			alert("Please select one answer then submit");
			return false;
		  }
		};*/


		// fetching ticket ID
		if (localStorage.getItem("UserDetails") || localStorage.getItem("UserDetails") === "undefined" || localStorage.getItem("UserDetails") === "") {
			//let ticket_Id = document.getElementById("ticket_Id").innerHTML = JSON.parse(localStorage.getItem('UserDetails')).TambolaTicketNumber;
			generate_table(JSON.parse(localStorage.getItem('UserDetails')).TambolaTicket);
		}

		function generate_table(e) {
			console.log(e);
			console.log(e.first);
			console.log(e.second);

			console.log(e.third);

			var table = document.getElementById("myTable");
			var row = table.insertRow(0);
			

			for (let step = 8; step >= 0; step--) {
				var cell1 = row.insertCell(0);
				var currentvalue = e.third[step];
				if (currentvalue > 0) {
					cell1.innerHTML = "<div id = " + currentvalue + " class='value'> <img src='images/ticket-icons/"+ currentvalue +".png' /> </div>";
					
				}else{
					cell1.innerHTML = "<div id = " + currentvalue + " class='zero'> " + currentvalue + "</div>";
				}
				
			}

			var row = table.insertRow(0);
			var i = 0;
			for (let step = 8; step >= 0; step--) {
				var cell1 = row.insertCell(0);
				var currentvalue = e.second[step];
				if (currentvalue > 0) {
					cell1.innerHTML = "<div id = " + currentvalue + " class='value'>  <img src='images/ticket-icons/"+ currentvalue +".png' /> </div>";
				}else{
					cell1.innerHTML = "<div id = " + currentvalue + " class='zero'> " + currentvalue + "</div>";
				}
				
			}

			var row = table.insertRow(0);

			for (let step = 8; step >= 0; step--) {
				var cell1 = row.insertCell(0);
				var currentvalue = e.first[step];
				if (currentvalue > 0) {
					cell1.innerHTML = "<div id = " + currentvalue + " class='value'>  <img src='images/ticket-icons/"+ currentvalue +".png' /> </div>";
				}else{
					cell1.innerHTML = "<div id = " + currentvalue + " class='zero'> " + currentvalue + "</div>";
				}
			}
		}
		



		// Answer Riddle API
		let riddleId = null;
		let riddleAnswer = null;
		let answerValue = null;


		function answerRiddle() {
			var data = {};
			let userPhone = localStorage.getItem('Phone');
			let user_Token = localStorage.getItem('user_Token');
			data.Phone = userPhone;
			console.log(userPhone);
			$.ajax({
				type: "POST",
				url: "http://13.234.143.20:3005/api/riddle/fetchoneriddle",
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						//window.location.href = "generated-ticket.html";
						riddleId = response.Data._id;
						console.log('Riddle Id' +riddleId);
						console.log(response);
						//console.log(response.Token);
						let riddleQuestion = document.getElementById("riddleQuestion").innerHTML = response.Data.question;
						let riddleAnswerOption = document.getElementById("riddleAnswerOption").innerHTML;
						console.log(response.Data.options);

						var markup = "";
						for (var i = 0; i < response.Data.options.length; i++) {
							markup += '<li>' + response.Data.options[i] + '</li>'
						}
						$("#formGroup").html(markup);


						$('#riddleAnswerOption #formGroup li').on('click', function () {
							var val = $(this).html();
							$("#riddleAnswerOption #formGroup li").removeClass("active");
							$(this).addClass("active");
							answerValue = val;
						});

					} else {
						$("#riddle .question-area").hide();
						$("#riddle .modal-body #error").show().html(response.Data);
						console.log(response);
					}
				}
			});
			return false;
		};





		// Submit Riddle Answer API
		function submitRiddleAnswer() {
			var data = {};
			let userPhone = localStorage.getItem('Phone');
			let user_Token = localStorage.getItem('user_Token');
			data.Phone = userPhone;
			data._id = riddleId;
			data.answer = answerValue;
			console.log(data);
			$.ajax({
				type: "POST",
				url: "http://13.234.143.20:3005/api/riddle/validateriddle",
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						//window.location.href = "generated-ticket.html";
						console.log(response);
						$("#riddle .modal-body #error").show().html(response.Data);
						$("#riddle .modal-body .question-area").hide();
					} else {
						$("#riddle .modal-body .question-area").hide();
						$("#riddle .modal-body #error").show().html(response.Data);
					}
				}
			});
			return false;
		};



		// Answer Jumble API	
		let jumbleId = null;
		let jumbleAnswer = null;
		let jumbleAnswerValue = null;


		function answerJumble() {
			var data = {};
			let userPhone = localStorage.getItem('Phone');
			let user_Token = localStorage.getItem('user_Token');
			data.Phone = userPhone;
			console.log(userPhone);
			$.ajax({
				type: "POST",
				url: "http://13.234.143.20:3005/api/jumble/fetchOneJumble",
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						//window.location.href = "generated-ticket.html";
						jumbleId = response.Data._id;
						console.log(jumbleId);
						console.log(response);
						//console.log(response.Token);
						let jumbleImg = document.getElementById("jumbleImg").src = response.Data.jumbleImage;
						let riddleAnswerOption = document.getElementById("riddleAnswerOption").innerHTML;

						var jumbleMarkup = "";
						for (var i = 0; i < response.Data.jumbleWord.length; i++) {
							jumbleMarkup += '<input class="btn" type="button" value= \'' + response.Data.jumbleWord[i] + '\' onclick="jumbleForm.jumbleAnswer.value += \'' + response.Data.jumbleWord[i] + '\' " >'
						}
						$("#jumbleButton").html(jumbleMarkup);
						$("#jumble .modal-body #error").show().html(response.Data);
					} else {
						$("#jumble .question-area").hide();
						$("#jumble .modal-body #error").show().html(response.Data);
						console.log(response);
					}
				}
			});
			return false;
		};


		// Submit Jumble Answer API
		function submitJumbleAnswer() {
			var data = {};
			let userPhone = localStorage.getItem('Phone');
			let user_Token = localStorage.getItem('user_Token');
			let jumbleAnswerValue = document.getElementById("jumbleAnswer").value;
			data.Phone = userPhone;
			data._id = jumbleId;
			data.answer = jumbleAnswerValue;
			console.log(data);
			$.ajax({
				type: "POST",
				url: "http://13.234.143.20:3005/api/jumble/validateJumble",
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						//window.location.href = "generated-ticket.html";
						console.log(response);
						//console.log(response.Token);
						$("#jumble .modal-body #error").show().html(response.Data);
						$("#jumble .modal-body .question-area").hide();
					} else {
						$("#jumble .modal-body #error").show().html(response.Data);
						$("#jumble .modal-body .question-area").hide();
					}
				}
			});
			return false;
		};



// Referral Sharing 
		function onreferLinkClick() {	
			let userPhone = localStorage.getItem('Phone');
			let user_Token = localStorage.getItem('user_Token');
			var data = {};
			data.Phone = userPhone;
			console.log("sent user phone " + userPhone);
			$.ajax({
				type: "GET",
				url: "http://13.234.143.20:3005/api/getreferrals/link?Phone="+userPhone,
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						
						console.log(response);
					} else {
						console.log(response);
					}
				}
			});
			return false;
		};
		
		
		// Coin Balance
		function totalEarnings() {	
			let userPhone = localStorage.getItem('Phone');
			let user_Token = localStorage.getItem('user_Token');
			var data = {};
			data.Phone = userPhone;
			console.log("sent user phone " + userPhone);
			$.ajax({
				type: "GET",
				url: "http://13.234.143.20:3005/api/user/coins/details?Phone="+userPhone,
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						$("#totalEarnings").modal("show");
						$("#totalEarnings #coinBalanceDiv").show();
						$("#totalEarnings #coinBalanceDiv strong").html(response.Data.coins);
						
						var earnedCoinList = "";
						for (var i = 0; i < response.Data.AllCoins.length; i++) {
						if (response.Data.AllCoins[i].Coin > 0){
							earnedCoinList += '<li>' + '<label>' + response.Data.AllCoins[i].Coin + '</label>' + 
							'<span>'+ response.Data.AllCoins[i].Game + '</span>' + '</li>';
						}};
						$("#earnedCoinList ul").html(earnedCoinList);
						
						$(".navigation").hide();
						$(".menu-bar").show();
						$(".overlay").hide();
						console.log(response);
					} else {
						console.log(response);
					}
				}
			});
			$.ajax({
				type: "GET",
				url: "http://13.234.143.20:3005/api/user/total/earning?Phone="+userPhone,
				headers: { "authorization": 'Bearer ' + user_Token },
				//contentType: "application/json",
				data: data,
				cache: false,
				success: function (response) {
					if (response.Success == true) {
						$("#totalEarnings").modal("show");
						$("#totalEarnings #zoneDiv").show();
						$(".navigation").hide();
						$(".menu-bar").show();
						$(".overlay").hide();
						if(response.Data.CurrentZone == null){
						$("#totalEarnings #zoneDiv .label").html("No Coupon Activated Yet");
						}else{
							$("#totalEarnings #zoneDiv strong").html(response.Data.CurrentZone);
							$("#totalEarnings #zoneDiv .couponWorth i").html(response.Data.Discount);
						}
						console.log(response);
					} else {
						console.log(response);
					}
				}
			});
			return false;
		};
		
		

		// Defining Menu login logout
		let login_menu = document.getElementById("login")
		let logout_menu = document.getElementById("logout")
		let total_earning = document.getElementById("total_earning")
		
		// Logout function
		function logout(){
			localStorage.clear();
			location.reload();
		}

		// check token and phone of user else logout
		if (!localStorage.getItem("user_Token") || localStorage.getItem("user_Token") === "undefined" || localStorage.getItem("user_Token") === "") {
			window.location.href = "index.html";
		} else if (!localStorage.getItem("UserDetails") || localStorage.getItem("UserDetails") === "undefined" || localStorage.getItem("UserDetails") === "") {
			window.location.href = "enter-otp.html";
		} else if (!localStorage.getItem("Phone") || localStorage.getItem("Phone") === "undefined" || localStorage.getItem("Phone") === "") {
			window.location.href = "register.html";
		} else {
			login_menu.style.display = "none";
			logout_menu.style.display = "block";
			total_earning.style.display = "block";
		};
	</script>

</body>

</html>